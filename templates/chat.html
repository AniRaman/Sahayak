<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sahayak Educational AI Assistant</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #2c3e50; margin-bottom: 10px; }
        .header p { color: #7f8c8d; }
        .chat-container { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
        .chat-header { background: #3498db; color: white; padding: 20px; }
        .chat-messages { height: 400px; overflow-y: auto; padding: 20px; }
        .message { margin-bottom: 15px; }
        .user-message { text-align: right; }
        .ai-message { text-align: left; }
        .message-content { display: inline-block; max-width: 70%; padding: 12px 16px; border-radius: 18px; }
        .user-message .message-content { background: #3498db; color: white; }
        .ai-message .message-content { background: #ecf0f1; color: #2c3e50; }
        .input-area { padding: 20px; border-top: 1px solid #ecf0f1; }
        .form-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .form-row select, .form-row input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        .input-container { display: flex; gap: 10px; }
        .input-container textarea { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 6px; resize: vertical; min-height: 60px; }
        .send-btn { background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; }
        .send-btn:hover { background: #2980b9; }
        .file-upload { margin-top: 10px; }
        .agents-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .agent-card { background: white; padding: 15px; border-radius: 8px; border: 2px solid #ecf0f1; cursor: pointer; transition: border-color 0.3s; }
        .agent-card:hover { border-color: #3498db; }
        .agent-card.selected { border-color: #3498db; background: #f8f9fa; }
        .agent-icon { font-size: 24px; margin-bottom: 8px; }
        .agent-name { font-weight: bold; margin-bottom: 5px; }
        .agent-desc { font-size: 12px; color: #7f8c8d; }
        .loading { text-align: center; color: #7f8c8d; padding: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ“ Sahayak Educational AI Assistant</h1>
            <p>Your intelligent companion for learning and education</p>
        </div>
        
        <div id="agents-section">
            <h3>Choose an Agent (Optional)</h3>
            <div class="agents-grid" id="agents-grid">
                <div class="loading">Loading agents...</div>
            </div>
        </div>
        
        <div class="chat-container">
            <div class="chat-header">
                <h3>ðŸ’¬ Chat with Sahayak</h3>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="message ai-message">
                    <div class="message-content">
                        Hello! I'm Sahayak, your educational AI assistant. I can help you with:
                        <br>â€¢ Creating lesson plans and educational content
                        <br>â€¢ Generating worksheets and presentations
                        <br>â€¢ Answering questions about any subject
                        <br>â€¢ Creating educational images and diagrams
                        <br>â€¢ Finding educational resources
                        <br><br>How can I help you today?
                    </div>
                </div>
            </div>
            <div class="input-area">
                <div class="form-row">
                    <select id="subject">
                        <option value="">Select Subject</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Science">Science</option>
                        <option value="English">English</option>
                        <option value="Social Studies">Social Studies</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Arts">Arts</option>
                    </select>
                    <select id="grade">
                        <option value="">Select Grade</option>
                        <option value="K-2">K-2</option>
                        <option value="3-5">3-5</option>
                        <option value="6-8">6-8</option>
                        <option value="9-12">9-12</option>
                        <option value="College">College</option>
                    </select>
                    <input type="text" id="curriculum" placeholder="Curriculum (optional)">
                </div>
                <div class="input-container">
                    <textarea id="user-input" placeholder="Type your message here..."></textarea>
                    <button class="send-btn" onclick="sendMessage()">Send</button>
                </div>
                <div class="file-upload">
                    <input type="file" id="file-input" accept=".pdf,.docx,.txt,.jpg,.png">
                    <button onclick="uploadFile()" style="margin-left: 10px; padding: 8px 16px;">Upload File</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedAgent = '';
        
        // Load agents
        fetch('/api/agents')
            .then(response => response.json())
            .then(data => {
                const grid = document.getElementById('agents-grid');
                grid.innerHTML = '';
                
                Object.entries(data.agents).forEach(([key, agent]) => {
                    const card = document.createElement('div');
                    card.className = 'agent-card';
                    card.onclick = () => selectAgent(key, card);
                    card.innerHTML = `
                        <div class="agent-icon">${agent.icon}</div>
                        <div class="agent-name">${agent.name}</div>
                        <div class="agent-desc">${agent.description}</div>
                    `;
                    grid.appendChild(card);
                });
            });
        
        function selectAgent(agentKey, cardElement) {
            document.querySelectorAll('.agent-card').forEach(card => card.classList.remove('selected'));
            cardElement.classList.add('selected');
            selectedAgent = agentKey;
        }
        
        function addMessage(content, isUser = false) {
            const messagesDiv = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            messageDiv.innerHTML = `<div class="message-content">${content}</div>`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;
            
            addMessage(message, true);
            input.value = '';
            
            const requestData = {
                user_input: message,
                subject: document.getElementById('subject').value,
                grade_level: document.getElementById('grade').value,
                curriculum: document.getElementById('curriculum').value,
                force_agent: selectedAgent
            };
            
            addMessage('Processing...', false);
            
            fetch('/api/process', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                // Remove loading message
                const messages = document.getElementById('chat-messages');
                messages.removeChild(messages.lastChild);
                
                if (data.status === 'success') {
                    let response = `**Analysis:** ${data.analysis?.type || 'General'}\n\n`;
                    response += `**Recommended Agent:** ${data.recommended_agent}\n\n`;
                    response += `**Response:** ${data.message}`;
                    addMessage(response.replace(/\n/g, '<br>'));
                } else {
                    addMessage(`Error: ${data.error_message || 'Unknown error'}`);
                }
            })
            .catch(error => {
                const messages = document.getElementById('chat-messages');
                messages.removeChild(messages.lastChild);
                addMessage(`Error: ${error.message}`);
            });
        }
        
        function uploadFile() {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a file first');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('user_input', 'Please analyze this file');
            formData.append('subject', document.getElementById('subject').value);
            formData.append('grade_level', document.getElementById('grade').value);
            formData.append('curriculum', document.getElementById('curriculum').value);
            formData.append('force_agent', selectedAgent);
            
            addMessage(`ðŸ“Ž Uploaded: ${file.name}`, true);
            addMessage('Processing file...', false);
            
            fetch('/api/process-file', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                const messages = document.getElementById('chat-messages');
                messages.removeChild(messages.lastChild);
                
                if (data.status === 'success') {
                    let response = `**File Analysis:** ${data.analysis?.type || 'File processed'}\n\n`;
                    response += `**Recommended Agent:** ${data.recommended_agent}\n\n`;
                    response += `**Response:** ${data.message}`;
                    addMessage(response.replace(/\n/g, '<br>'));
                } else {
                    addMessage(`Error: ${data.error_message || 'File processing failed'}`);
                }
            })
            .catch(error => {
                const messages = document.getElementById('chat-messages');
                messages.removeChild(messages.lastChild);
                addMessage(`Error: ${error.message}`);
            });
        }
        
        // Enter key support
        document.getElementById('user-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    </script>
</body>
</html>